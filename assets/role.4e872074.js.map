{"version":3,"file":"role.4e872074.js","sources":["../../src/views/system/role-permission.vue","../../src/views/system/role.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <el-tree\r\n            class=\"mgb10\"\r\n            ref=\"tree\"\r\n            :data=\"data\"\r\n            node-key=\"id\"\r\n            default-expand-all\r\n            show-checkbox\r\n            :default-checked-keys=\"checkedKeys\"\r\n        />\r\n        <el-button type=\"primary\" @click=\"onSubmit\">保存权限</el-button>\r\n    </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref } from 'vue';\r\nimport { ElTree } from 'element-plus';\r\nimport { menuData } from '@/components/menu';\r\n\r\nconst props = defineProps({\r\n    permissOptions: {\r\n        type: Object,\r\n        required: true,\r\n    },\r\n});\r\n\r\nconst menuObj = ref({});\r\n// const data = menuData.map((item) => {\r\n//     if (item.children) {\r\n//         menuObj.value[item.id] = item.children.map((sub) => sub.id);\r\n//     }\r\n//     return {\r\n//         id: item.id,\r\n//         label: item.title,\r\n//         children: item.children?.map((child) => {\r\n//             return {\r\n//                 id: child.id,\r\n//                 label: child.title,\r\n//             };\r\n//         }),\r\n//     };\r\n// });\r\n\r\nconst getTreeData = (data) => {\r\n    return data.map((item) => {\r\n        const obj: any = {\r\n            id: item.id,\r\n            label: item.title,\r\n        };\r\n        if (item.children) {\r\n            menuObj.value[item.id] = item.children.map((sub) => sub.id);\r\n            obj.children = getTreeData(item.children);\r\n        }\r\n        return obj;\r\n    });\r\n};\r\nconst data = getTreeData(menuData);\r\nconst checkData = (data: string[]) => {\r\n    return data.filter((item) => {\r\n        return !menuObj.value[item] || data.toString().includes(menuObj.value[item].toString());\r\n    });\r\n};\r\n// 获取当前权限\r\nconst checkedKeys = ref<string[]>(checkData(props.permissOptions.permiss));\r\n\r\n// 保存权限\r\nconst tree = ref<InstanceType<typeof ElTree>>();\r\nconst onSubmit = () => {\r\n    // 获取选中的权限\r\n    const keys = [...tree.value!.getCheckedKeys(false), ...tree.value!.getHalfCheckedKeys()] as number[];\r\n    console.log(keys);\r\n};\r\n</script>\r\n\r\n<style scoped></style>\r\n","<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nexport default defineComponent({\n  name: 'system-role',\n})\n</script>\n<template>\r\n    <div>\r\n        <TableSearch :query=\"query\" :options=\"searchOpt\" :search=\"handleSearch\" />\r\n        <div class=\"container\">\r\n\r\n            <TableCustom :columns=\"columns\" :tableData=\"tableData\" :total=\"page.total\" :viewFunc=\"handleView\"\r\n                :delFunc=\"handleDelete\" :page-change=\"changePage\" :editFunc=\"handleEdit\">\r\n                <template #toolbarBtn>\r\n                    <el-button type=\"warning\" :icon=\"CirclePlusFilled\" @click=\"visible = true\">新增</el-button>\r\n                </template>\r\n                <template #status=\"{ rows }\">\r\n                    <el-tag type=\"success\" v-if=\"rows.status\">启用</el-tag>\r\n                    <el-tag type=\"danger\" v-else>禁用</el-tag>\r\n                </template>\r\n                <template #permissions=\"{ rows }\">\r\n                    <el-button type=\"primary\" size=\"small\" plain @click=\"handlePermission(rows)\">管理</el-button>\r\n                </template>\r\n            </TableCustom>\r\n        </div>\r\n        <el-dialog :title=\"isEdit ? '编辑' : '新增'\" v-model=\"visible\" width=\"700px\" destroy-on-close\r\n            :close-on-click-modal=\"false\" @close=\"closeDialog\">\r\n            <TableEdit :form-data=\"rowData\" :options=\"options\" :edit=\"isEdit\" :update=\"updateData\" />\r\n        </el-dialog>\r\n        <el-dialog title=\"查看详情\" v-model=\"visible1\" width=\"700px\" destroy-on-close>\r\n            <TableDetail :data=\"viewData\">\r\n                <template #status=\"{ rows }\">\r\n                    <el-tag type=\"success\" v-if=\"rows.status\">启用</el-tag>\r\n                    <el-tag type=\"danger\" v-else>禁用</el-tag>\r\n                </template>\r\n            </TableDetail>\r\n        </el-dialog>\r\n        <el-dialog title=\"权限管理\" v-model=\"visible2\" width=\"500px\" destroy-on-close>\r\n            <RolePermission :permiss-options=\"permissOptions\" />\r\n        </el-dialog>\r\n    </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\" name=\"system-role\">\r\nimport { ref, reactive } from 'vue';\r\nimport { ElMessage } from 'element-plus';\r\nimport { Role } from '@/types/role';\r\nimport { fetchRoleData } from '@/api';\r\nimport TableCustom from '@/components/table-custom.vue';\r\nimport TableDetail from '@/components/table-detail.vue';\r\nimport RolePermission from './role-permission.vue'\r\nimport { CirclePlusFilled } from '@element-plus/icons-vue';\r\nimport { FormOption, FormOptionList } from '@/types/form-option';\r\n\r\n// 查询相关\r\nconst query = reactive({\r\n    name: '',\r\n});\r\nconst searchOpt = ref<FormOptionList[]>([\r\n    { type: 'input', label: '角色名称：', prop: 'name' }\r\n])\r\nconst handleSearch = () => {\r\n    changePage(1);\r\n};\r\n\r\n// 表格相关\r\nlet columns = ref([\r\n    { type: 'index', label: '序号', width: 55, align: 'center' },\r\n    { prop: 'name', label: '角色名称' },\r\n    { prop: 'key', label: '角色标识' },\r\n    { prop: 'status', label: '状态' },\r\n    { prop: 'permissions', label: '权限管理' },\r\n    { prop: 'operator', label: '操作', width: 250 },\r\n])\r\nconst page = reactive({\r\n    index: 1,\r\n    size: 10,\r\n    total: 0,\r\n})\r\nconst tableData = ref<Role[]>([]);\r\nconst getData = async () => {\r\n    const res = await fetchRoleData()\r\n    tableData.value = res.data.list;\r\n    page.total = res.data.pageTotal;\r\n};\r\ngetData();\r\nconst changePage = (val: number) => {\r\n    page.index = val;\r\n    getData();\r\n};\r\n\r\n// 新增/编辑弹窗相关\r\nconst options = ref<FormOption>({\r\n    labelWidth: '100px',\r\n    span: 24,\r\n    list: [\r\n        { type: 'input', label: '角色名称', prop: 'name', required: true },\r\n        { type: 'input', label: '角色标识', prop: 'key', required: true },\r\n        { type: 'switch', label: '状态', prop: 'status', required: false, activeText: '启用', inactiveText: '禁用' },\r\n    ]\r\n})\r\nconst visible = ref(false);\r\nconst isEdit = ref(false);\r\nconst rowData = ref({});\r\nconst handleEdit = (row: Role) => {\r\n    rowData.value = { ...row };\r\n    isEdit.value = true;\r\n    visible.value = true;\r\n};\r\nconst updateData = () => {\r\n    closeDialog();\r\n    getData();\r\n};\r\nconst closeDialog = () => {\r\n    visible.value = false;\r\n    isEdit.value = false;\r\n    rowData.value = {};\r\n};\r\n\r\n// 查看详情弹窗相关\r\nconst visible1 = ref(false);\r\nconst viewData = ref({\r\n    row: {},\r\n    list: [],\r\n    column: 1\r\n});\r\nconst handleView = (row: Role) => {\r\n    viewData.value.row = { ...row }\r\n    viewData.value.list = [\r\n        {\r\n            prop: 'id',\r\n            label: '角色ID',\r\n        },\r\n        {\r\n            prop: 'name',\r\n            label: '角色名称',\r\n        },\r\n        {\r\n            prop: 'key',\r\n            label: '角色标识',\r\n        },\r\n        {\r\n            prop: 'status',\r\n            label: '角色状态',\r\n        },\r\n    ]\r\n    visible1.value = true;\r\n};\r\n\r\n// 删除相关\r\nconst handleDelete = (row: Role) => {\r\n    ElMessage.success('删除成功');\r\n}\r\n\r\n\r\n// 权限管理弹窗相关\r\nconst visible2 = ref(false);\r\nconst permissOptions = ref({})\r\nconst handlePermission = (row: Role) => {\r\n    visible2.value = true;\r\n    permissOptions.value = {\r\n        id: row.id,\r\n        permiss: row.permiss\r\n    };\r\n}\r\n</script>\r\n\r\n<style scoped></style>"],"names":["props","__props","menuObj","ref","getTreeData","data2","item","obj","sub","data","menuData","checkedKeys","tree","onSubmit","keys","__default__","defineComponent","query","reactive","searchOpt","handleSearch","changePage","columns","page","tableData","getData","res","fetchRoleData","val","options","visible","isEdit","rowData","handleEdit","row","updateData","closeDialog","visible1","viewData","handleView","handleDelete","ElMessage","visible2","permissOptions","handlePermission"],"mappings":"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"}