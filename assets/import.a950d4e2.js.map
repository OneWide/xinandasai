{"version":3,"file":"import.a950d4e2.js","sources":["../../src/views/table/import.vue"],"sourcesContent":["<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nexport default defineComponent({\n  name: 'import',\n})\n</script>\n<template>\r\n    <div>\r\n        <div class=\"container\">\r\n            <div class=\"handle-box\">\r\n                <el-upload action=\"#\" :limit=\"1\" accept=\".xlsx, .xls\" :show-file-list=\"false\"\r\n                    :before-upload=\"beforeUpload\" :http-request=\"handleMany\">\r\n                    <el-button class=\"mr10\" type=\"success\">批量导入</el-button>\r\n                </el-upload>\r\n                <el-link href=\"/template.xlsx\" target=\"_blank\">下载模板</el-link>\r\n            </div>\r\n            <el-table :data=\"tableData\" border class=\"table\" header-cell-class-name=\"table-header\">\r\n                <el-table-column prop=\"id\" label=\"ID\" width=\"55\" align=\"center\"></el-table-column>\r\n                <el-table-column prop=\"name\" label=\"姓名\"></el-table-column>\r\n                <el-table-column prop=\"sno\" label=\"学号\"></el-table-column>\r\n                <el-table-column prop=\"class\" label=\"班级\"></el-table-column>\r\n                <el-table-column prop=\"age\" label=\"年龄\"></el-table-column>\r\n                <el-table-column prop=\"sex\" label=\"性别\"></el-table-column>\r\n            </el-table>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\" name=\"import\">\r\nimport { UploadProps } from 'element-plus';\r\nimport { ref, reactive } from 'vue';\r\nimport * as XLSX from 'xlsx';\r\n\r\ninterface TableItem {\r\n    id: number;\r\n    name: string;\r\n    sno: string;\r\n    class: string;\r\n    age: string;\r\n    sex: string;\r\n}\r\n\r\nconst tableData = ref<TableItem[]>([]);\r\n// 获取表格数据\r\nconst getData = () => {\r\n    tableData.value = [\r\n        {\r\n            id: 1,\r\n            name: '小明',\r\n            sno: 'S001',\r\n            class: '一班',\r\n            age: '10',\r\n            sex: '男',\r\n        },\r\n        {\r\n            id: 2,\r\n            name: '小红',\r\n            sno: 'S002',\r\n            class: '一班',\r\n            age: '9',\r\n            sex: '女',\r\n        },\r\n    ];\r\n};\r\ngetData();\r\n\r\nconst importList = ref<any>([]);\r\nconst beforeUpload: UploadProps['beforeUpload'] = async (rawFile) => {\r\n    importList.value = await analysisExcel(rawFile);\r\n    return true;\r\n};\r\nconst analysisExcel = (file: any) => {\r\n    return new Promise(function (resolve, reject) {\r\n        const reader = new FileReader();\r\n        reader.onload = function (e: any) {\r\n            const data = e.target.result;\r\n            let datajson = XLSX.read(data, {\r\n                type: 'binary',\r\n            });\r\n\r\n            const sheetName = datajson.SheetNames[0];\r\n            const result = XLSX.utils.sheet_to_json(datajson.Sheets[sheetName]);\r\n            resolve(result);\r\n        };\r\n        reader.readAsBinaryString(file);\r\n    });\r\n};\r\n\r\nconst handleMany = async () => {\r\n    // 把数据传给服务器后获取最新列表，这里只是示例，不做请求\r\n    const list = importList.value.map((item: any, index: number) => {\r\n        return {\r\n            id: index,\r\n            name: item['姓名'],\r\n            sno: item['学号'],\r\n            class: item['班级'],\r\n            age: item['年龄'],\r\n            sex: item['性别'],\r\n        };\r\n    });\r\n    tableData.value.push(...list);\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.handle-box {\r\n    display: flex;\r\n    margin-bottom: 20px;\r\n}\r\n\r\n.table {\r\n    width: 100%;\r\n    font-size: 14px;\r\n}\r\n</style>\r\n"],"names":["__default__","defineComponent","tableData","ref","importList","beforeUpload","rawFile","analysisExcel","file","resolve","reject","reader","e","data","datajson","XLSX.read","sheetName","result","XLSX.utils","handleMany","list","item","index"],"mappings":"sbAEAA,EAAAC,EAAA,CAA+B,KAAA,QAE/B,CAAA,qBAsCA,MAAAC,EAAAC,EAAA,CAAA,CAAA,GAEA,IAAA,CACID,EAAA,MAAA,CAAkB,CACd,GAAA,EACQ,KAAA,eACE,IAAA,OACD,MAAA,eACE,IAAA,KACF,IAAA,QACA,EACT,CACA,GAAA,EACQ,KAAA,eACE,IAAA,OACD,MAAA,eACE,IAAA,IACF,IAAA,QACA,CACT,CACJ,KAIJ,MAAAE,EAAAD,EAAA,CAAA,CAAA,EACAE,EAAA,MAAAC,IACIF,EAAA,MAAA,MAAAG,EAAAD,CAAA,EACA,IAEJC,EAAAC,GACI,IAAA,QAAA,SAAAC,EAAAC,EAAA,CACI,MAAAC,EAAA,IAAA,WACAA,EAAA,OAAA,SAAAC,EAAA,CACI,MAAAC,EAAAD,EAAA,OAAA,OACA,IAAAE,EAAAC,EAAAF,EAAA,CAA+B,KAAA,QACrB,CAAA,EAGV,MAAAG,EAAAF,EAAA,WAAA,GACAG,EAAAC,EAAA,cAAAJ,EAAA,OAAAE,EAAA,EACAP,EAAAQ,CAAA,CAAc,EAElBN,EAAA,mBAAAH,CAAA,CAA8B,CAAA,EAItCW,EAAA,SAAA,CAEI,MAAAC,EAAAhB,EAAA,MAAA,IAAA,CAAAiB,EAAAC,KACI,CAAO,GAAAA,EACC,KAAAD,EAAA,aACO,IAAAA,EAAA,aACD,MAAAA,EAAA,aACE,IAAAA,EAAA,aACF,IAAAA,EAAA,YACA,EACd,EAEJnB,EAAA,MAAA,KAAA,GAAAkB,CAAA,CAA4B"}